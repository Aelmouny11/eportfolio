---
title: "SQl"
---

## Syntaxe de base

### Création d'une table

La création d'une table est une étape fondamentale en SQL. Voici un exemple de syntaxe pour créer une table :

```sql
CREATE TABLE nom_table (
  colonne1 datatype1,
  colonne2 datatype2,
  ...
);
```

# contraintes dans Oracle SQL

## Contrainte de clé primaire (Primary Key)

- Une contrainte de clé primaire garantit l'unicité et l'identifiant d'une ligne dans une table. Elle est souvent utilisée pour définir une colonne ou un groupe de colonnes qui identifie de manière unique chaque enregistrement dans une table.

#### Exemple :

```sql
CREATE TABLE MaTable (
  id NUMBER PRIMARY KEY,
  nom VARCHAR2(50)
);
```

#### Contrainte d'intégrité référentielle (Foreign Key)

    La contrainte d'intégrité référentielle garantit que les valeurs d'une colonne dans une table (table enfant) correspondent aux valeurs d'une autre colonne dans une autre table (table parente). Elle est utilisée pour établir des relations entre les tables.

#### Exemple :

```sql

CREATE TABLE TableEnfant (
  id NUMBER PRIMARY KEY,
  id_parent NUMBER,
  nom VARCHAR2(50),
  CONSTRAINT fk_id_parent FOREIGN KEY (id_parent) REFERENCES TableParent(id)
);
```

Contrainte d'unicité (Unique)

    La contrainte d'unicité garantit que les valeurs d'une colonne sont uniques dans une table. Elle est utilisée pour s'assurer qu'aucune valeur en double ne peut être insérée dans la colonne spécifiée.

#### Exemple :

```sql

CREATE TABLE MaTable (
  id NUMBER PRIMARY KEY,
  code VARCHAR2(10) UNIQUE,
  nom VARCHAR2(50)
);
```

#### Contrainte de vérification (Check)

    La contrainte de vérification définit une condition qui doit être satisfaite pour toutes les lignes d'une table. Elle est utilisée pour restreindre les valeurs acceptables dans une colonne.

#### Exemple :

```sql

CREATE TABLE MaTable (
  id NUMBER PRIMARY KEY,
  age NUMBER,
  CONSTRAINT check_age CHECK (age >= 18)
);
```

#### Contrainte de valeur par défaut (Default)

    La contrainte de valeur par défaut spécifie une valeur par défaut pour une colonne si aucune valeur n'est spécifiée lors de l'insertion.

#### Exemple :

```sql

CREATE TABLE MaTable (
  id NUMBER PRIMARY KEY,
  date_creation DATE DEFAULT SYSDATE
);
```

Note : Les contraintes peuvent être définies lors de la création d'une table ou ajoutées/modifiées ultérieurement en utilisant l'instruction ALTER TABLE. Les contraintes jouent un rôle essentiel dans la garantie de l'intégrité des données et l'application des règles métier dans une base de données Oracle SQL.

Chaque colonne est spécifiée avec un nom et un type de données correspondant.

## Contrainte apres creation des tables

Les contraintes dans Oracle SQL sont utilisées pour garantir l'intégrité des données dans les tables. Elles définissent des règles ou des conditions que les données doivent respecter. Voici une vue d'ensemble des principales contraintes et des exemples de snippets SQL pour les ajouter à une table existante.

#### Contrainte de clé primaire (Primary Key) :

    La contrainte de clé primaire garantit l'unicité et l'identifiant d'une ligne dans une table.

```sql
ALTER TABLE MaTable
ADD CONSTRAINT pk_id PRIMARY KEY (id);
```

#### Contrainte d'intégrité référentielle (Foreign Key) :

    La contrainte d'intégrité référentielle garantit que les valeurs d'une colonne dans une table correspondent aux valeurs d'une autre colonne dans une autre table.

```sql

ALTER TABLE TableEnfant
ADD CONSTRAINT fk_id_parent FOREIGN KEY (id_parent)
REFERENCES TableParent(id);
```

#### Contrainte d'unicité (Unique) :

    La contrainte d'unicité garantit que les valeurs d'une colonne sont uniques dans une table.

```sql

ALTER TABLE MaTable
ADD CONSTRAINT uc_code UNIQUE (code);
```

#### Contrainte de vérification (Check) :

    La contrainte de vérification définit une condition qui doit être satisfaite pour toutes les lignes d'une table.

```sql

ALTER TABLE MaTable
ADD CONSTRAINT check_age CHECK (age >= 18);
```

#### Contrainte de valeur par défaut (Default) :

    La contrainte de valeur par défaut spécifie une valeur par défaut pour une colonne si aucune valeur n'est spécifiée lors de l'insertion.

```sql

ALTER TABLE MaTable
MODIFY (date_creation DEFAULT SYSDATE);
```

Ajouter des contraintes après la création de la table :
Pour ajouter des contraintes à une table existante, vous pouvez utiliser l'instruction ALTER TABLE avec la clause ADD CONSTRAINT.

```sql

ALTER TABLE MaTable
ADD CONSTRAINT fk_tableA_id FOREIGN KEY (tableA_id) REFERENCES TableA(id);
```

### Insertion d'un enregistrement

Pour insérer un nouvel enregistrement dans une table, on utilise la commande `INSERT INTO`. Voici un exemple :

```sql
INSERT INTO nom_table (colonne1, colonne2, ...)
VALUES (valeur1, valeur2, ...);
```

Les valeurs spécifiées correspondent aux données que l'on souhaite insérer.

### Mise à jour des données

La mise à jour des données existantes dans une table se fait avec la commande `UPDATE`. Voici un exemple :

```sql
UPDATE nom_table
SET colonne1 = nouvelle_valeur1, colonne2 = nouvelle_valeur2, ...
WHERE condition;
```

La clause `WHERE` permet de spécifier les enregistrements à mettre à jour.

### Suppression d'enregistrements

La suppression d'enregistrements se fait avec la commande `DELETE FROM`. Voici un exemple :

```sql
DELETE FROM nom_table WHERE condition;
```

La clause `WHERE` est utilisée pour spécifier les enregistrements à supprimer.

### Sélection de données

Pour extraire des données d'une table, on utilise la commande `SELECT`. Voici un exemple :

```sql
SELECT colonne1, colonne2, ...
FROM nom_table
WHERE condition;
```

## LID

## Langage d'interrogation des données

Une requête permet de rechercher des données dans une ou plusieurs tables à partir de critères simples ou complexes.

Une requête est une instruction SELECT.

## Syntaxe SELECT

```sql
SELECT [ { DISTINCT | UNIQUE } | ALL ] listeColonnes
FROM nomTable1 [,nomTable2]…
[ WHERE condition ]
[ GROUP BY col1, col2..]
[ HAVING condition ]
[ { UNION | UNION ALL | INTERSECT | MINUS } ( sousRequête )]
[ ORDER BY col1] ;
```

## Projection : éléments du SELECT

Extraction de toutes les colonnes :

```sql
SELECT * FROM Pilote;
```

Extraction de certaines colonnes :

```sql
SELECT compa, brevet FROM Pilote;
```

Alias : AS

Les alias permettent de renommer des colonnes à l'affichage ou des tables dans la requête.

```sql
SELECT aliasPilotes.compa AS c1, aliasPilotes.nom
FROM Pilote aliasPilotes;
```

Duplicatas

```sql
SELECT compa
FROM Pilote;

SELECT DISTINCT(compa)
FROM Pilote;
```

Eléments calculés

Il est possible d'évaluer et d'afficher simultanément des expressions dans la clause SELECT.

```sql
SELECT brevet, nbHVol, nbHVol*nbHVol AS auCarré, 10*nbHVol+5/2
FROM Pilote;
```

Ordre

Pour trier le résultat d'une requête, il faut spécifier la clause d'ordonnancement par ORDER BY.

```sql
SELECT brevet, nom
FROM Pilote
ORDER BY nom DESC;
```

Concaténation

Il est possible de concaténer des expressions par l'opérateur de concaténation ||.

```sql
SELECT brevet, nom || ' ' || compa AS "Embauche"
FROM Pilote;
```

Clause WHERE : Exemples

Afficher les clients dont la date de naissance n'est pas le 25 décembre 1960 ?

```sql
SELECT *
FROM clients
WHERE naissance <> '25/12/1960';
```

Afficher les clients dont on connaît le code postal ?

```sql
SELECT *
FROM clients
WHERE code_postal IS NOT NULL;
```

Afficher les articles bleus dont le prix est supérieur ou égal à 100 ou inférieur strictement à 10 ?

```sql
SELECT *
FROM articles
WHERE couleur='bleu'
AND (prix >= 100 OR prix < 10);
```

Afficher les articles dont le prix est entre 10 et 100 ?

```sql
SELECT *
FROM articles
WHERE prix BETWEEN 10 AND 100;
```

Afficher les clients qui ne s'appellent ni 'Salah' ni 'Salam' ni 'Alami' ?

```sql
SELECT *
FROM clients
WHERE nom NOT IN ('Salah', 'Salam', 'Alami');
```

Afficher les clients dont le nom commence par A?

```sql
SELECT *
FROM clients
WHERE nom LIKE 'A%';
```

Afficher les clients dont le nom ne contient pas 'm' ?

```sql
SELECT *
FROM clients
WHERE nom NOT LIKE '%m%';
```

### Sous-Requêtes

- Une sous-requête est une requête SELECT utilisée à l'intérieur d'une requête principale.
- La sous-requête doit être délimitée par des parenthèses et ne peut extraire que les colonnes de la table du premier SELECT.
- Les sous-requêtes peuvent renvoyer une valeur scalaire, une colonne ou une table.

#### Sous-requêtes renvoyant une valeur scalaire

- Une sous-requête renvoie une valeur scalaire si elle comporte une seule ligne et une seule colonne.
- Les sous-requêtes scalaires peuvent être utilisées comme une colonne supplémentaire ou pour évaluer des conditions (WHERE ou HAVING).

Exemple de requête avec une sous-requête renvoyant une valeur scalaire :

```sql

SELECT COUNT(*) FROM Fournisseur;
```

#### Sous-requêtes renvoyant une colonne

- Les sous-requêtes renvoyant une colonne peuvent être utilisées avec des opérateurs de comparaison tels que IN, ANY, ALL, etc.
- Les opérateurs multi-lignes permettent de comparer un élément avec une liste de valeurs renvoyée par la sous-requête.

##### Exemple de requête avec une sous-requête renvoyant une colonne :

```sql
SELECT *
FROM Commandes
WHERE client IN (SELECT numero
                 FROM Clients
                 WHERE dateNaiss = '21/03/1970');
```

#### Exemple de requête avec une sous-requête renvoyant une colonne et utilisant l'opérateur ALL :

```sql
SELECT *
FROM Articles
WHERE prix >= ALL (SELECT prix
                   FROM Articles
                   WHERE couleur = 'bleu');
```

#### Exemple de requête avec une sous-requête renvoyant une colonne et utilisant l'opérateur ANY :

```sql
SELECT *
FROM Articles
WHERE prix > ANY (SELECT prix
                  FROM Articles
                  WHERE couleur = 'bleu');
```

#### Opérateur EXISTS

- L'opérateur EXISTS permet de vérifier l'existence d'enregistrements renvoyés par une sous-requête.
- Il peut être utilisé pour effectuer des filtrages conditionnels.

##### Exemple de requête avec l'opérateur EXISTS :

```sql
SELECT *
FROM client
WHERE EXISTS (SELECT *
              FROM commandes
              WHERE client.numero = commandes.client
                AND commandes.date = '13/5/2010');
```

##### Sous-requêtes corrélées

- Une sous-requête corrélée est évaluée pour chaque ligne de la requête principale.
- Elle permet de lier les résultats de la sous-requête aux valeurs de la requête principale.

### Exemple de requête avec une sous-requête corrélée :

```sql
SELECT a.article, a.quantite, b.client
FROM lignes_commande a, commandes b
WHERE a.article = b.numero
  AND (a.article, a.quantite) IN
      (SELECT article, MAX(quantite)
       FROM lignes_commande
       GROUP BY article);
```

## Vues

Les vues sont utilisées pour restreindre l'accès à certaines données d'une table en créant une table virtuelle à partir d'une ou plusieurs tables existantes. Les vues agissent comme des fenêtres à travers lesquelles seules les données spécifiques sont visibles.

### Exemple de création d'une vue :

```sql

CREATE VIEW ma_vue AS
SELECT colonne1, colonne2
FROM table
WHERE condition;
```

#### Manipulation des vues

Les vues peuvent être manipulées comme des tables normales, c'est-à-dire qu'on peut effectuer des opérations d'insertion, de modification et de suppression sur les données de la vue. Les modifications sont propagées à la table d'origine si les conditions sont remplies.

#### Exemple d'insertion dans une vue :

```sql

INSERT INTO ma_vue (colonne1, colonne2)
VALUES (valeur1, valeur2);
```

#### Mise à jour des vues

Les vues peuvent être mises à jour à l'aide de requêtes de mise à jour, qui se traduiront par des modifications dans la table d'origine si les conditions sont remplies.

#### Exemple de mise à jour d'une vue :

```sql

UPDATE ma_vue
SET colonne1 = nouvelle_valeur
WHERE condition;
```

#### Requêtes avec vues

Les vues peuvent être utilisées dans des requêtes pour simplifier les opérations et faciliter l'accès aux données restreintes.

#### Exemple de requête avec vue :

```sql

SELECT *
FROM ma_vue
WHERE condition;
```

#### Contrôle de mise à jour

Il est possible de contrôler les mises à jour sur une vue en utilisant les clauses WITH CHECK OPTION ou WITH READ ONLY lors de la création de la vue. Ces clauses permettent de spécifier les conditions dans lesquelles les modifications sont autorisées ou non.

Exemple de création d'une vue en lecture seule :

```sql

CREATE VIEW ma_vue_readonly AS
SELECT colonne1, colonne2
FROM table
WHERE condition
WITH READ ONLY;
```

## Déclencheurs"

### C'est quoi un déclencheur?

Un déclencheur, également appelé "trigger" en anglais, est un bloc de code PL/SQL qui est invoqué automatiquement à chaque fois qu'un événement spécifique se produit dans une base de données Oracle. Ces événements sont généralement liés aux manipulations des données d'une table, telles que l'insertion, la suppression ou la modification d'une ligne. Les déclencheurs ont un nom, une partie déclaration, un corps et une partie exception. Ils sont exécutés de manière transparente par Oracle, sans nécessiter d'appel explicite de la part de l'utilisateur.

### Utilité des déclencheurs

Les déclencheurs peuvent être utilisés dans différentes situations, notamment :

- Implémenter des contraintes d'intégrité complexes qui ne peuvent pas être définies comme des contraintes déclaratives d'une table.
- Gérer l'audit en enregistrant les modifications effectuées sur une table.
- Effectuer automatiquement une action lorsqu'une autre action se produit, par exemple mettre à jour une table lorsqu'une nouvelle ligne est insérée dans une autre table.
- Maintenir des valeurs dérivées, par exemple en maintenant un stock d'actions sans avoir à le modifier directement.
- Archiver des données, permettant un accès facile aux données archivées via des déclencheurs.

### Types de déclencheurs

Les déclencheurs peuvent être classés en deux catégories :

1. Déclencheurs de synchronisation :

   - BEFORE : déclenchés avant l'exécution de l'instruction qui a activé le déclencheur.
   - AFTER : déclenchés après l'exécution de l'instruction.

2. Déclencheurs d'événement :
   - INSERT, UPDATE et DELETE : déclenchés en fonction du type d'instruction qui a activé le déclencheur.

### Création d'un déclencheur

Pour créer un déclencheur dans une base de données Oracle, on utilise la commande `CREATE TRIGGER` avec les éléments suivants :

- Nom du déclencheur.
- Table associée au déclencheur.
- Moment où le déclencheur est activé : BEFORE ou AFTER.
- Commande qui active le déclencheur : INSERT, UPDATE ou DELETE.
- Condition de filtrage (optionnelle).
- Bloc PL/SQL à exécuter lorsque le déclencheur est activé.

### Exemple de création d'un déclencheur

```sql
CREATE OR REPLACE TRIGGER nom_trigger
BEFORE INSERT
ON nom_table
FOR EACH ROW
BEGIN
    -- Bloc de code PL/SQL à exécuter
    -- lorsque le déclencheur est activé
END;
```

### Activation et désactivation des déclencheurs

Un déclencheur peut être activé ou désactivé selon les besoins. Pour cela, on utilise les commandes ALTER TRIGGER et ENABLE ou DISABLE. Par exemple :

    - `ALTER TRIGGER nom_trigger DISABLE;` pour désactiver un déclencheur.
    - `ALTER TRIGGER nom_trigger ENABLE;` pour activer un déclencheur.

Suppression d'un déclencheur

Pour supprimer un déclencheur, on utilise la commande DROP TRIGGER suivie du nom du déclencheur à supprimer. Par exemple :

    - DROP TRIGGER nom_trigger; pour supprimer un déclencheur.
